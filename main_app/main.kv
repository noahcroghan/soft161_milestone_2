<LoginScreen>:
    name: 'LoginScreen'
    BoxLayout:
        orientation: 'vertical'
        padding: [50, 100]
        spacing: 20

        Label:
            text: 'Login to Your Profile'
            font_size: 40
            font_name: 'Roboto-Bold'
            size_hint_y: None
            height: dp(60)

        Spinner:
            id: existing_users_spinner
            text: 'Select Existing User'
            values: []
            size_hint_y: None
            height: dp(40)

        TextInput:
            id: new_username_input
            hint_text: 'Enter New Username'
            multiline: False
            size_hint_y: None
            height: dp(40)

        Button:
            text: 'Create Profile'
            on_press: app.root.get_screen('LoginScreen').create_username()
            size_hint_y: None
            height: dp(40)

        Button:
            text: 'Login'
            on_press: app.root.get_screen('LoginScreen').login_selected_user()
            size_hint_y: None
            height: dp(40)
        Label:
            id: login_message
            text: ""

<MainScreen>:
    name: 'MainScreen'
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: 'Cryptocurrency App'
                font_size: 60
                font_name: 'Roboto-Bold'

        GridLayout:
            cols: 1
            rows: 8
            padding: 20
            spacing: 20
            Label:
                text: "Welcome: " + app.current_user if app.current_user else ""
                font_size: 40
                font_name: 'Roboto-Bold'
            Button:
                text: 'New Cryptocurrency'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'NewCryptoScreen'
            Button:
                text: 'New Portfolio Entry'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'NewPortfolioScreen'
            Button:
                text: 'Check Portfolio Value'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'CheckPortfolioScreen'
            Button:
                text: 'Select Coin'
                on_press:
                    root.manager.current = 'SelectCoinScreen'
                    root.manager.transition.direction = 'left'
            Button:
                text: 'View History'
                on_press:
                    root.manager.current = 'ViewHistoryScreen'
                    root.manager.transition.direction = 'left'
            Button:
                text: 'About/Help'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'HelpScreen'
            Button:
                text: 'Switch User'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'SwitchUserScreen'

<SwitchUserScreen>
    name: 'SwitchUserScreen'
    BoxLayout:
        orientation: 'vertical'
        padding: [50, 100]
        spacing: 20

        Label:
            text: 'Switch the User'
            font_size: 40
            font_name: 'Roboto-Bold'
            size_hint_y: None
            height: dp(60)

        Spinner:
            id: existing_users_spinner
            text: 'Select Existing User'
            values: []
            size_hint_y: None
            height: dp(40)

        TextInput:
            id: new_username_input
            hint_text: 'Enter New Username'
            multiline: False
            size_hint_y: None
            height: dp(40)

        Button:
            text: 'Create Profile'
            on_press: root.get_new_user()
            size_hint_y: None
            height: dp(40)

        Button:
            text: 'Login'
            on_press: root.confirm_user_switch()
            size_hint_y: None
            height: dp(40)
        Label:
            id: feedback_label
            text: ""

        Button:
            text: 'BACK'
            on_press:
                root.manager.transition.direction = 'right'
                root.manager.current = 'MainScreen'

<HelpScreen>:
    name: 'HelpScreen'
    ScrollView:
        BoxLayout:
            orientation: 'vertical'
            padding: dp(20)
            spacing: dp(10)
            size_hint_y: None
            height: self.minimum_height

            Label:
                text: 'Help & About'
                font_size: 40
                font_name: 'Roboto-Bold'
                size_hint_y: None
                height: dp(50)

            Label:
                text: 'Using the Main App'
                font_size: 35
                size_hint_y: None
                height: dp(40)

            Label:
                text:
                    "[b]Login Screen[/b]\n\n" \
                    "The first screen you are shown is the login screen, which lets you login to an existing user or create a new user\n\n" \
                    "[b]Main Menu[/b]\n\n" \
                    "From the main menu, you can navigate to the other apps.\n\n" \
                    "This includes the 'New Cryptocurrency' screen, 'New Portfolio Entry' screen, 'Check Portfolio Value' screen, 'Select Coin' screen, 'View History' screen, 'About/Help' screen, and 'Switch User' screen.\n\n" \
                    "The main menu also displays the currently logged in user."
                markup: True
                font_size: 28
                text_size: self.width, None
                halign: 'left'
                valign: 'top'
                size_hint_y: None
                height: self.texture_size[1]

            Label:
                text: 'Using the Portfolio Tracker App'
                font_size: 35
                size_hint_y: None
                height: dp(40)

            Label:
                text: "Placeholder" # TODO: Add instructions
                markup: True
                font_size: 28
                text_size: self.width, None
                halign: 'left'
                valign: 'top'
                size_hint_y: None
                height: self.texture_size[1]

            Label:
                text: 'Using the Historical Price Viewer App'
                font_size: 35
                size_hint_y: None
                height: dp(40)

            Label:
                text:
                    "[b]Select Coin Screen[/b]\n\n" \
                    "- Scroll to see the top 100 cryptocurrencies.\n\n" \
                    "- Search for coins (by name or symbol) using the search bar.\n\n" \
                    "- View coin names, symbols, current prices, and last 24 hour percent change.\n\n" \
                    "- Tap on a coin to be sent to the history screen for the selected coin.\n\n" \
                    "[b]View History Screen[/b]\n\n" \
                    "- Enter a coin's symbol (or leave previously selected coin).\n\n" \
                    "- Choose the date range and chart type.\n\n" \
                    "- Tap Submit to view a price chart.\n\n" \
                    "- Tap Export to save data to a CSV."
                markup: True
                font_size: 28
                text_size: self.width, None
                halign: 'left'
                valign: 'top'
                size_hint_y: None
                height: self.texture_size[1]

            Label:
                text: 'API Reference'
                font_size: 35
                size_hint_y: None
                height: dp(40)

            Button:
                text: 'Visit CoinGecko API documentation'
                size_hint_y: None
                height: dp(40)
                on_press: root.open_link()

            Button:
                text: 'Back to Main Menu'
                size_hint_y: None
                height: dp(40)
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'MainScreen'

<SelectCoinScreen>:
    name: 'SelectCoinScreen'
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(10)


        Label:
            text: 'Select Coin'
            bold: True
            halign: 'center'
            valign: 'middle'
            text_size: self.size
            size_hint_y: None
            height: dp(30)

        TextInput:
            size_hint_y: None
            spacing: dp(10)
            padding: [dp(10), 0]
            id: search_input
            hint_text: 'Search...'
            multiline: False
            on_text: root.search_coins()

        Label:
            id: select_coin_message
            text: 'Loading Data...'
            font_size: '14sp'
            size_hint_y: None
            halign: 'center'

        BoxLayout:
            size_hint_y: None
            height: dp(40)
            spacing: dp(10)
            padding: [dp(10), 0]

            Label:
                text: '[u]Coin Name [i](Symbol)[/i][/u]'
                markup: True
            Label:
                text: '[u]Current Price[/u]'
                markup: True
            Label:
                text: '[u]24h percent change[/u]'
                markup: True
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            BoxLayout:
                id: coin_container
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
        Button:
            text: 'Back to Main Menu'
            size_hint_y: None
            height: dp(40)
            on_press:
                root.manager.current = 'MainScreen'
                root.manager.transition.direction = 'right'
                # clear textbox
                root.ids.search_input.text = ''


<ViewHistoryScreen>:
    name: 'ViewHistoryScreen'

    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(10)

        ScrollView:
            do_scroll_y: True
            do_scroll_x: False

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: dp(10)
                spacing: dp(10)

                Label:
                    text: 'View History'
                    bold: True
                    size_hint_y: None
                    height: dp(30)
                    halign: 'center'
                    valign: 'middle'
                    text_size: self.size

                TextInput:
                    id: coin_symbol_input
                    hint_text: 'Coin Symbol'
                    multiline: False
                    size_hint_y: None
                    height: dp(40)

                TextInput:
                    id: start_date_input
                    hint_text: 'Start Date (YYYY-MM-DD)'
                    multiline: False
                    size_hint_y: None
                    height: dp(40)

                TextInput:
                    id: end_date_input
                    hint_text: 'End Date (YYYY-MM-DD)'
                    multiline: False
                    size_hint_y: None
                    height: dp(40)

                Spinner:
                    id: historical_price_chart_spinner
                    text: 'Select Chart Type'
                    values: ['Line Chart', 'Bar Chart', 'Candlestick Chart']
                    size_hint_y: None
                    height: dp(40)


                Button:
                    text: 'Submit'
                    on_press: root.submit_history()
                    size_hint_y: None
                    height: dp(40)

                Label:
                    id: history_message
                    text: ''
                    font_size: '14sp'
                    color: (1, 0, 0, 1)
                    size_hint_y: None
                    height: dp(20)
                    halign: 'center'
                    text_size: self.size

                Image:
                    id: chart
                    source: ''
                    size_hint_y: None
                    height: dp(300)
                    fit_mode: 'contain'

                Button:
                    text: 'Export data to CSV file'
                    on_press: root.export_to_csv()
                    size_hint_y: None
                    height: dp(40)
                    disabled: not root.is_historical_data_generated
                    opacity: 1 if root.is_historical_data_generated else 0

        Button:
            text: 'Back to Select Coin'
            on_press:
                root.manager.current = 'SelectCoinScreen'
                root.manager.transition.direction = 'right'
            size_hint_y: None
            height: dp(40)
            disabled: not root.came_from_select_coin
            opacity: 1 if root.came_from_select_coin else 0

        Button:
            text: 'Back to Main Menu'
            on_press:
                root.manager.current = 'MainScreen'
                root.manager.transition.direction = 'right'
            size_hint_y: None
            height: dp(40)

<NewCryptoScreen>:
    name: "NewCryptoScreen"
    GridLayout:
        cols: 1
        rows: 9
        padding: 20
        spacing: 10
        Label:
            text: 'New Cryptocurrency'
            font_size: 50
            font_name: 'Roboto-Bold'
        Label:
            text: "Crypto Name"
            font_size: 35
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_crypto_in_1
#            text: f'{app.input_text}'
            size_hint_y: None
            height: 50
            font_size: 30
        Label:
            text: "Crypto Symbol"
            font_size: 35
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_crypto_in_2
#            text: f'{app.input_text}'
            size_hint_y: None
            height: 50
            font_size: 30
        Label:
            text: "Crypto Price"
            font_size: 35
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_crypto_in_3
#            text: f'{app.input_text}'
            size_hint_y: None
            height: 50
            font_size: 30
        Label:
            id: new_crypto_message
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
            font_size: 50
        GridLayout:
            cols: 2
            rows: 1
            spacing: 10
            size_hint_y: None
            height: 140
            Button:
                text: "HOME"
                size_hint_x: None
                width: 140
                font_size: 40
                font_name: 'Roboto-Bold'
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'MainScreen'
#                    app.go_to_home(new_crypto_message)
            Button:
                text: "SUBMIT"
                font_size: 80
                font_name: 'Roboto-Bold'
                on_press:
                    app.submit_data(new_crypto_message, new_crypto_in_1, new_crypto_in_2, new_crypto_in_3, "New Crypto Added", "Error: Invalid Data")
<NewPortfolioScreen>:
    name: "NewPortfolioScreen"
    GridLayout:
        cols: 1
        rows: 9
        padding: 20
        spacing: 10
        Label:
            text: 'New Portfolio Entry'
            font_size: 50
            font_name: 'Roboto-Bold'
#        Label:
#            text: "Crypto Name"
#            font_size: 35
#            text_size: self.size
#            halign: 'left'
        Spinner:
            id: new_portfolio_crypto
            text: 'Crypto Name'
            values: []
            size_hint_y: None
            height: 50
            font_size: 30
        Label:
            text: "Quantity Purchased"
            font_size: 35
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_portfolio_in_2
#            text: f'{app.input_text}'
            size_hint_y: None
            height: 50
            font_size: 30
        Label:
            text: "Date Purchased"
            font_size: 35
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_portfolio_in_3
#            text: f'{app.input_text}'
            size_hint_y: None
            height: 50
            font_size: 30
        Label:
            id: new_portfolio_message
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
            font_size: 50
        GridLayout:
            cols: 2
            rows: 1
            spacing: 10
            size_hint_y: None
            height: 140
            Button:
                text: "HOME"
                size_hint_x: None
                width: 140
                font_size: 40
                font_name: 'Roboto-Bold'
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'MainScreen'
#                    app.go_to_home(new_portfolio_message)
            Button:
                text: "SUBMIT"
                font_size: 80
                font_name: 'Roboto-Bold'
                on_press:
                    app.submit_data(new_portfolio_message, new_portfolio_in_1, new_portfolio_in_2, new_portfolio_in_3, "New Portfolio Added", "Error: Invalid Data")
<CheckPortfolioScreen>:
    name: "CheckPortfolioScreen"
    GridLayout:
        cols: 1
        rows: 13
        padding: 20
        spacing: 10
        Label:
            text: 'Check Portfolio Value'
            font_size: 50
            font_name: 'Roboto-Bold'
        Label:
            text: ""
        Label:
            text: "Portfolio ID"
            font_size: 35
            text_size: self.size
            halign: 'left'
        TextInput:
            id: check_value_in
#            text: f'{app.input_text}'
            size_hint_y: None
            height: 50
            font_size: 30
        Label:
            text: ""
        Label:
            text: "Crypto Current Price:"
            font_size: 35
            text_size: self.size
            halign: 'left'
        Label:
#            text: f'{app.crypto_price}'
            color: ((50/256), (222/256), (153/256), 1.0)
            font_size: 35
            text_size: self.size
            halign: 'left'
        Label:
            text: "Current Portfolio Value:"
            font_size: 35
            text_size: self.size
            halign: 'left'
        Label:
#            text: f'{app.portfolio_value}'
            color: ((50/256), (222/256), (153/256), 1.0)
            font_size: 35
            text_size: self.size
            halign: 'left'
        Label:
            text: "Portfolio Value Change:"
            font_size: 35
            text_size: self.size
            halign: 'left'
        Label:
#            text: f'{app.portfolio_value_change}'
            color: ((50/256), (222/256), (153/256), 1.0)
            font_size: 35
            text_size: self.size
            halign: 'left'
        Label:
            id: check_portfolio_message
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
            font_size: 45
        GridLayout:
            cols: 2
            rows: 1
            spacing: 10
            size_hint_y: None
            height: 140
            Button:
                text: "HOME"
                size_hint_x: None
                width: 140
                font_size: 40
                font_name: 'Roboto-Bold'
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'MainScreen'
#                    app.go_to_home(check_portfolio_message)
            Button:
                on_press: app.check_value(check_value_in, check_portfolio_message)
                text: "CHECK"
                font_size: 80
                font_name: 'Roboto-Bold'


<Screen>:
    canvas.before:
        Color:
            rgba: ((21/256), (44/256), (54/256), 1.0)
        Rectangle:
            pos: self.pos
            size: self.size

<Button>
    background_normal: ''
    background_color: ((13/256), (179/256), (93/256), 1.0)
    font_size: 30