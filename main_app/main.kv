<LoginScreen>:
    name: 'LoginScreen'
    BoxLayout:
        orientation: 'vertical'
        padding: [sp(50), sp(100)]
        spacing: sp(20)

        Label:
            text: 'Login to Your Profile'

            size_hint_y: None
            height: sp(60)

        Spinner:
            id: existing_users_spinner
            text: 'Select Existing User'
            values: []
            size_hint_y: None
            height: sp(40)

        TextInput:
            id: new_username_input
            hint_text: 'Enter New Username'
            multiline: False
            size_hint_y: None
            height: sp(40)

        Button:
            text: 'Create Profile'
            on_press: app.root.get_screen('LoginScreen').create_username()
            size_hint_y: None
            height: sp(40)

        Button:
            text: 'Login'
            on_press: app.root.get_screen('LoginScreen').login_selected_user()
            size_hint_y: None
            height: sp(40)
        Label:
            id: login_message
            text: ""

<MainScreen>:
    name: 'MainScreen'
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: 'Cryptocurrency App'

                font_size: sp(30)

        GridLayout:
            cols: 1
            rows: 9
            padding: sp(20)
            spacing: sp(20)
            Label:
                id: welcome_label
                text: "Welcome: " + app.current_user

            Button:
                text: 'New Cryptocurrency'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'NewCryptoScreen'
            Button:
                text: 'Update Cryptocurrency'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'UpdateCryptoScreen'
            Button:
                text: 'New Portfolio Entry'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'NewPortfolioScreen'
            Button:
                text: 'Check Portfolio Value'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'CheckPortfolioScreen'
            Button:
                text: 'Select Coin'
                on_press:
                    root.manager.current = 'SelectCoinScreen'
                    root.manager.transition.direction = 'left'
            Button:
                text: 'View History'
                on_press:
                    root.manager.current = 'ViewHistoryScreen'
                    root.manager.transition.direction = 'left'
            Button:
                text: 'About/Help'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'HelpScreen'
            Button:
                text: 'Switch User'
                on_press:
                    root.manager.transition.direction = 'left'
                    root.manager.current = 'SwitchUserScreen'

<SwitchUserScreen>
    name: 'SwitchUserScreen'
    BoxLayout:
        orientation: 'vertical'
        padding: [sp(50), sp(100)]
        spacing: sp(20)

        Label:
            text: 'Switch the User'

            size_hint_y: None
            height: sp(60)

        Spinner:
            id: existing_users_spinner
            text: 'Select Existing User'
            values: []
            size_hint_y: None
            height: sp(40)

        TextInput:
            id: new_username_input
            hint_text: 'Enter New Username'
            multiline: False
            size_hint_y: None
            height: sp(40)

        Button:
            text: 'Create Profile'
            on_press: root.get_new_user()
            size_hint_y: None
            height: sp(40)

        Button:
            text: 'Login'
            on_press: root.confirm_user_switch()
            size_hint_y: None
            height: sp(40)
        Label:
            id: login_message
            text: ""

        Button:
            text: 'BACK'
            on_press:
                root.manager.transition.direction = 'right'
                root.manager.current = 'MainScreen'

<HelpScreen>:
    name: 'HelpScreen'
    ScrollView:
        BoxLayout:
            orientation: 'vertical'
            padding: sp(20)
            spacing: sp(10)
            size_hint_y: None
            height: self.minimum_height

            Label:
                text: 'Help & About'

                size_hint_y: None
                height: sp(50)

            Label:
                text: 'Using the Main App'
                size_hint_y: None
                height: sp(40)

            Label:
                text:
                    "[b]Login Screen[/b]\n\n" \
                    "- The first screen you are shown is the login screen, which lets you login to an existing user or create a new user\n\n" \
                    "[b]Main Menu[/b]\n\n" \
                    "- From the main menu, you can navigate to the other apps.\n\n" \
                    "- This includes the 'New Cryptocurrency' screen, 'New Portfolio Entry' screen, 'Check Portfolio Value' screen, 'Select Coin' screen, 'View History' screen, 'About/Help' screen, and 'Switch User' screen.\n\n" \
                    "- The main menu also displays the currently logged in user."
                markup: True
                text_size: self.width, None
                halign: 'left'
                valign: 'top'
                size_hint_y: None
                height: self.texture_size[1]

            Label:
                text: 'Using the Portfolio Tracker App'
                size_hint_y: None
                height: sp(40)

            Label:
                markup: True
                text:
                    "[b]New Cryptocurrency Screen[/b]\n\n" \
                    "- Enter a coin's name.\n\n" \
                    "- Enter a coin's symbol.\n\n" \
                    "- Enter a coin's current price.\n\n" \
                    "- Enter a coin's percent price change in the last 24 hours.\n\n" \
                    "- Tap submit to add a new cryptocurrency to the database.\n\n" \
                    "[b]New Portfolio Entry Screen[/b]\n\n" \
                    "- Select a coin from the dropdown menu.\n\n" \
                    "- Enter the number of coins purchased for this portfolio entry.\n\n" \
                    "- Enter the date that the coins were purchased in a YYYY-MM-DD format.\n\n" \
                    "- Tap submit to add a new portfolio entry to the database.\n\n" \
                    "[b]Check Portfolio Value Screen[/b]\n\n" \
                    '- Tap "View Portfolio Summary" button to see the total initial investment amount, total current value, and percent change between the two of all the portfolio entries of the current user.\n\n' \
                    '- Tap "View Portfolio Pie Chart" button to see a pie chart showing each entry\'s contribution the the user\'s portfolio\'s value.\n\n' \
                    '- Select a portfolio entry to see its initial investment amount, current value, and percent change between the two.\n\n' \
                    '- If the portfolio summary is currently being displayed, tap the "Reload Portfolio" button to display the portfolio summary with a new current value and percent change.\n\n' \
                    '- If a portfolio entry has been selected, tap the "Update Entry" button to go to the Update Entry Screen for that portfolio entry.\n\n' \
                    "[b]Update Entry Screen[/b]\n\n" \
                    "- Select a coin from the dropdown menu (or leave the current coin).\n\n" \
                    "- Enter the number of coins purchased for this portfolio entry.\n\n" \
                    "- Enter the date that the coins were purchased in a YYYY-MM-DD format.\n\n" \
                    '- Tap the "UPDATE" button to change the crypto_id, coin_amount, and purchase_date of the selected portfolio entry in the database to the entered values.\n\n' \
                    '- Tap the "DELETE" button to delete the selected portfolio entry from the database and go back to the Check Portfolio Screen.\n\n' \
                    '- Tap the "BACK" button to go back to the Check Portfolio Screen.\n\n'
                text_size: self.width, None
                halign: 'left'
                valign: 'top'
                size_hint_y: None
                height: self.texture_size[1]

            Label:
                text: 'Using the Historical Price Viewer App'
                size_hint_y: None
                height: sp(40)

            Label:
                text:
                    "[b]Select Coin Screen[/b]\n\n" \
                    "- Scroll to see the top 100 cryptocurrencies.\n\n" \
                    "- Search for coins (by name or symbol) using the search bar.\n\n" \
                    "- View coin names, symbols, current prices, and last 24 hour percent change.\n\n" \
                    "- Tap on a coin to be sent to the history screen for the selected coin.\n\n" \
                    "[b]View History Screen[/b]\n\n" \
                    "- Enter a coin's symbol (or leave previously selected coin).\n\n" \
                    "- Choose the date range and chart type.\n\n" \
                    "- Tap Submit to view a price chart.\n\n" \
                    "- Tap Export to save data to a CSV."
                markup: True
                text_size: self.width, None
                halign: 'left'
                valign: 'top'
                size_hint_y: None
                height: self.texture_size[1]

            Label:
                text: 'API Reference'
                size_hint_y: None
                height: sp(40)

            Button:
                text: 'Visit CoinGecko API documentation'
                size_hint_y: None
                height: sp(40)
                on_press: root.open_link()

            Button:
                text: 'HOME'
                size_hint_y: None
                height: sp(40)
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'MainScreen'

<SelectCoinScreen>:
    name: 'SelectCoinScreen'
    BoxLayout:
        orientation: 'vertical'
        padding: sp(10)
        spacing: sp(10)


        Label:
            text: 'Select Coin'
            bold: True
            halign: 'center'
            valign: 'middle'
            text_size: self.size
            size_hint_y: None
            height: sp(30)

        TextInput:
            size_hint_y: None
            spacing: sp(10)
            padding: [sp(10), 0]
            id: search_input
            hint_text: 'Search...'
            multiline: False
            on_text: root.search_coins()

        Label:
            id: select_coin_message
            text: 'Loading Data...'
            size_hint_y: None
            halign: 'center'

        BoxLayout:
            size_hint_y: None
            height: sp(20)
            spacing: sp(10)
            padding: [sp(10), 0]

            Label:
                text: '[u]Coin Name [i](Symbol)[/i][/u]'
                markup: True
                font_size: sp(14)
            Label:
                text: '[u]Current Price[/u]'
                markup: True
                font_size: sp(14)
            Label:
                text: '[u]24h percent change[/u]'
                markup: True
                font_size: sp(14)
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            BoxLayout:
                id: coin_container
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
        Button:
            text: 'HOME'
            size_hint_y: None
            height: sp(40)
            on_press:
                root.manager.current = 'MainScreen'
                root.manager.transition.direction = 'right'
                # clear textbox
                root.ids.search_input.text = ''


<ViewHistoryScreen>:
    name: 'ViewHistoryScreen'

    BoxLayout:
        orientation: 'vertical'
        padding: sp(10)
        spacing: sp(10)

        ScrollView:
            do_scroll_y: True
            do_scroll_x: False

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: sp(10)
                spacing: sp(10)

                Label:
                    text: 'View History'
                    bold: True
                    size_hint_y: None
                    height: sp(30)
                    halign: 'center'
                    valign: 'middle'
                    text_size: self.size

                Spinner:
                    id: coin_name_spinner
                    text: 'Select Coin'
                    size_hint_y: None
                    height: sp(40)

                TextInput:
                    id: start_date_input
                    hint_text: 'Start Date (YYYY-MM-DD)'
                    multiline: False
                    size_hint_y: None
                    height: sp(40)

                TextInput:
                    id: end_date_input
                    hint_text: 'End Date (YYYY-MM-DD)'
                    multiline: False
                    size_hint_y: None
                    height: sp(40)

                Spinner:
                    id: historical_price_chart_spinner
                    text: 'Select Chart Type'
                    values: ['Line Chart', 'Bar Chart', 'Candlestick Chart']
                    size_hint_y: None
                    height: sp(40)


                Button:
                    id: view_history_submit_button
                    text: 'Submit'
                    on_press: root.submit_history()
                    size_hint_y: None
                    height: sp(40)

                Label:
                    id: history_message
                    text: ''
                    color: (1, 0, 0, 1)
                    size_hint_y: None
                    height: sp(20)
                    halign: 'center'
                    text_size: self.size

                Image:
                    id: chart
                    source: ''
                    size_hint_y: None
                    height: sp(300)
                    fit_mode: 'contain'

                Button:
                    text: 'Export data to CSV file'
                    on_press: root.export_to_csv()
                    size_hint_y: None
                    height: sp(40)
                    disabled: not root.is_historical_data_generated
                    opacity: 1 if root.is_historical_data_generated else 0

        Button:
            text: 'Back to Select Coin'
            on_press:
                root.manager.current = 'SelectCoinScreen'
                root.manager.transition.direction = 'right'
            size_hint_y: None
            height: sp(40)
            disabled: not root.came_from_select_coin
            opacity: 1 if root.came_from_select_coin else 0

        Button:
            text: 'HOME'
            on_press:
                root.manager.current = 'MainScreen'
                root.manager.transition.direction = 'right'
            size_hint_y: None

<NewCryptoScreen>:
    name: "NewCryptoScreen"
    GridLayout:
        cols: 1
        rows: 11
        padding: sp(20)
        spacing: sp(10)
        Label:
            text: 'New Cryptocurrency'
            font_size: sp(30)
        Label:
            text: "Crypto Name"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_crypto_name_input
            size_hint_y: None
            hint_text: "(e.g. 'bitcoin')"
            multiline: False
            height: sp(50)
        Label:
            text: "Crypto Symbol"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_crypto_symbol_input
            size_hint_y: None
            hint_text: "(e.g. 'btc')"
            multiline: False
            height: sp(50)
        Label:
            text: "Crypto Price"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_crypto_price_input
            size_hint_y: None
            height: sp(50)
            multiline: False
            hint_text: "(e.g. 51863.04)"
            input_filter: 'float'
        Label:
            text: "Percent Change last 24H"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_crypto_percent_change_24h_input
            size_hint_y: None
            height: sp(50)
            multiline: False
            hint_text: "(e.g. 0.04)"
            input_filter: 'float'
        Label:
            id: new_crypto_message
            markup: True
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
        GridLayout:
            cols: 2
            rows: 1
            spacing: sp(10)
            size_hint_y: None
            height: sp(140)
            Button:
                text: "HOME"
                size_hint_x: None
                width: sp(140)

                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'MainScreen'
            Button:
                text: "SUBMIT"
                on_press: root.submit_new_crypto()
<UpdateCryptoScreen>:
    name: "UpdateCryptoScreen"
    GridLayout:
        cols: 1
        rows: 13
        padding: sp(20)
        spacing: sp(10)
        Label:
            text: 'Update Cryptocurrency'
            font_size: sp(30)
        Spinner:
            id: update_crypto_spinner
            text: 'Select Crypto'
            values: []
            size_hint_y: None
            height: sp(50)
        Label:
            text: "Crypto Name"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: update_crypto_name_input
            size_hint_y: None
            hint_text: "(e.g. 'bitcoin')"
            multiline: False
            height: sp(50)
        Label:
            text: "Crypto Symbol"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: update_crypto_symbol_input
            size_hint_y: None
            hint_text: "(e.g. 'btc')"
            multiline: False
            height: sp(50)
        Label:
            text: "Crypto Price"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: update_crypto_price_input
            size_hint_y: None
            height: sp(50)
            multiline: False
            hint_text: "(e.g. 51863.04)"
            input_filter: 'float'
        Label:
            text: "Percent Change last 24H"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: update_crypto_percent_change_24h_input
            size_hint_y: None
            height: sp(50)
            multiline: False
            hint_text: "(e.g. 0.04)"
            input_filter: 'float'
        Label:
            id: update_crypto_message
            markup: True
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
        GridLayout:
            cols: 2
            rows: 1
            spacing: sp(10)
            size_hint_y: None
            height: sp(60)
            Button:
                text: "UPDATE"
                size_hint_x: None
                width: sp(240)
                on_press: app.root.get_screen('UpdateCryptoScreen').update_crypto()
            Button:
                text: "DELETE"
                on_press: app.root.get_screen('UpdateCryptoScreen').delete_crypto()
        Button:
            text: "HOME"
            size_hint_y: None
            height: sp(50)
            on_press:
                root.manager.transition.direction = 'right'
                root.manager.current = 'MainScreen'
                app.root.get_screen('UpdateCryptoScreen').go_home()
<NewPortfolioScreen>:
    name: "NewPortfolioScreen"
    GridLayout:
        cols: 1
        rows: 9
        padding: sp(20)
        spacing: sp(10)
        Label:
            text: 'New Portfolio Entry'
        Spinner:
            id: new_portfolio_crypto
            text: 'Crypto Name'
            values: []
            size_hint_y: None
            height: sp(50)
        Label:
            text: "Quantity Purchased"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_portfolio_quantity
            size_hint_y: None
            height: sp(50)
        Label:
            text: "Date Purchased"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: new_portfolio_date
            hint_text: 'YYYY-MM-DD'
            size_hint_y: None
            height: sp(50)
        Label:
            id: new_portfolio_message
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
        GridLayout:
            cols: 2
            rows: 1
            spacing: sp(10)
            size_hint_y: None
            height: sp(140)
            Button:
                text: "HOME"
                size_hint_x: None
                width: sp(140)

                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'MainScreen'
                    app.root.get_screen('NewPortfolioScreen').go_home()
            Button:
                text: "SUBMIT"

                on_press: app.root.get_screen('NewPortfolioScreen').create_new_portfolio()
<CheckPortfolioScreen>:
    name: "CheckPortfolioScreen"
    GridLayout:
        cols: 1
        rows: 14
        padding: sp(20)
        spacing: sp(10)
        Label:
            text: 'Check Portfolio'
        Button:
            id: check_total_portfolio
            text: 'View Portfolio Summary'
            size_hint_y: None
            height: sp(35)
            on_press: app.root.get_screen('CheckPortfolioScreen').view_portfolio_summary()
        Button:
            id: check_portfolio_pie
            text: 'View Portfolio Pie Chart'
            size_hint_y: None
            height: sp(35)
            on_press: app.root.get_screen('CheckPortfolioScreen').create_portfolio_chart()
        Spinner:
            id: check_portfolio_ids
            text: 'Select Specific Entry'
            values: []
            size_hint_y: None
            height: sp(35)
            on_text: app.root.get_screen('CheckPortfolioScreen').portfolio_id_spinner_pressed()
        GridLayout:
            cols: 2
            rows: 1
            spacing: sp(10)
            height: sp(40)
            Button:
                id: reload_portfolio_button
                text: "Reload Portfolio"
                background_color: ((151/256), (199/256), (174/256), 1.0)
                on_press: app.root.get_screen('CheckPortfolioScreen').reload_portfolio()
            Button:
                id: update_entry_button
                text: "Update Entry"
                background_color: ((151/256), (199/256), (174/256), 1.0)
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'UpdateEntryScreen'
        Image:
            id: portfolio_chart
            source: ''
            size_hint_y: None
            size_hint_x: None
            width: sp(200)
            height: sp(200)
        Label:
            text: "Investment Amount:"
            text_size: self.size
            halign: 'left'
        Label:
            id: check_investment_amount
            color: ((50/256), (222/256), (153/256), 1.0)
            text_size: self.size
            halign: 'left'
        Label:
            text: "Current Portfolio Value:"
            text_size: self.size
            halign: 'left'
        Label:
            id: check_portfolio_value
            color: ((50/256), (222/256), (153/256), 1.0)
            text_size: self.size
            halign: 'left'
        Label:
            text: "Portfolio Value Change:"
            text_size: self.size
            halign: 'left'
        Label:
            id: check_value_change
            color: ((50/256), (222/256), (153/256), 1.0)
            text_size: self.size
            halign: 'left'
        Label:
            id: check_portfolio_message
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
        Button:
            text: "HOME"
            size_hint_y: None
            height: sp(40)
            on_press:
                root.manager.transition.direction = 'right'
                root.manager.current = 'MainScreen'
                app.root.get_screen('CheckPortfolioScreen').go_home()
<UpdateEntryScreen>
    name: "UpdateEntryScreen"
    GridLayout:
        cols: 1
        rows: 10
        padding: sp(20)
        spacing: sp(10)
        Label:
            text: 'Update Portfolio Entry'
        Label:
            id: update_entry_portfolio_number
            text: "Portfolio Entry:"
        Spinner:
            id: update_entry_crypto
            text: ''
            values: []
            size_hint_y: None
            height: sp(50)
        Label:
            text: "Quantity Purchased"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: update_entry_quantity
            size_hint_y: None
            height: sp(50)
        Label:
            text: "Date Purchased"
            text_size: self.size
            halign: 'left'
        TextInput:
            id: update_entry_date
            hint_text: 'YYYY-MM-DD'
            size_hint_y: None
            height: sp(50)
        Label:
            id: update_entry_message
            text: ""
            color: ((50/256), (222/256), (153/256), 1.0)
        GridLayout:
            cols: 2
            rows: 1
            spacing: sp(10)
            size_hint_y: None
            height: sp(60)
            Button:
                text: "UPDATE"
                size_hint_x: None
                width: sp(240)
                on_press: app.root.get_screen('UpdateEntryScreen').update_entry()
            Button:
                text: "DELETE"
                on_press: app.root.get_screen('UpdateEntryScreen').delete_entry()
        Button:
            text: "BACK"
            size_hint_y: None
            height: sp(50)
            on_press:
                root.manager.transition.direction = 'right'
                root.manager.current = 'CheckPortfolioScreen'
                app.root.get_screen('UpdateEntryScreen').go_back()


<Screen>:
    canvas.before:
        Color:
            rgba: ((21/256), (44/256), (54/256), 1.0)
        Rectangle:
            pos: self.pos
            size: self.size

<Button>
    background_normal: ''
    background_color: ((13/256), (179/256), (93/256), 1.0)
    font_size: sp(30)
    font_name: 'Roboto-Bold'

<Label>:
    font_size: sp(20)
    font_name: 'Roboto-Bold'

<TextInput>:
    font_size: sp(16)
    font_name: 'Roboto-Bold'

<Spinner>:
    font_size: sp(14)
    font_name: 'Roboto-Bold'

